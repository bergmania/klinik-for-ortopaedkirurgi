---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
  noindex?: boolean;
}

const {
  title = SITE_TITLE,
  description = SITE_DESCRIPTION,
  image,
  type = 'website',
  noindex = false
} = Astro.props;

const pageTitle = title === SITE_TITLE ? title : `${title} | ${SITE_TITLE}`;
---

<!doctype html>
<html lang="da" dir="ltr">
  <head>
    <BaseHead
      title={pageTitle}
      description={description}
      image={image}
      type={type}
      noindex={noindex}
    />
  </head>
  <body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">
      Spring til hovedindhold
    </a>

    <Header />

    <main id="main-content" tabindex="-1">
      <slot />
    </main>

    <Footer />

    <!-- Back to top button -->
    <button
      id="back-to-top"
      class="back-to-top"
      aria-label="Tilbage til toppen"
      hidden
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="m18 15-6-6-6 6"/>
      </svg>
    </button>

    <script>
      // Back to top button functionality
      const backToTop = document.getElementById('back-to-top');

      if (backToTop) {
        window.addEventListener('scroll', () => {
          if (window.scrollY > 400) {
            backToTop.hidden = false;
          } else {
            backToTop.hidden = true;
          }
        }, { passive: true });

        backToTop.addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }

      // Handle focus for skip link
      const mainContent = document.getElementById('main-content');
      if (mainContent) {
        mainContent.addEventListener('blur', () => {
          mainContent.removeAttribute('tabindex');
        });
      }
    </script>
  </body>
</html>

<style is:global>
  html {
    scroll-behavior: smooth;
  }

  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }

    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  main {
    flex: 1;
  }

  /* Focus styles for accessibility */
  :focus-visible {
    outline: 3px solid var(--primary);
    outline-offset: 2px;
  }

  /* Remove outline for mouse users */
  :focus:not(:focus-visible) {
    outline: none;
  }

  /* Skip link styling */
  .skip-link {
    position: absolute;
    top: -100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--primary);
    color: var(--white);
    padding: 1rem 2rem;
    border-radius: 0 0 8px 8px;
    text-decoration: none;
    font-weight: 600;
    z-index: 9999;
    transition: top 0.2s ease;
  }

  .skip-link:focus {
    top: 0;
    outline: 3px solid var(--primary-dark);
    outline-offset: 2px;
  }

  /* Back to top button */
  .back-to-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--primary);
    color: var(--white);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--box-shadow);
    transition: background-color 0.2s ease, transform 0.2s ease;
    z-index: 100;
  }

  .back-to-top:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
  }

  .back-to-top:focus-visible {
    outline: 3px solid var(--primary-dark);
    outline-offset: 2px;
  }

  .back-to-top[hidden] {
    display: none;
  }

  /* Ensure interactive elements have minimum touch target size */
  button,
  a,
  input,
  select,
  textarea {
    min-height: 44px;
    min-width: 44px;
  }

  /* Exception for inline links */
  p a,
  li a,
  td a {
    min-height: auto;
    min-width: auto;
  }
</style>
